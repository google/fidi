<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fidi: The request parser for fidi (φίδι)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="fidi.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">fidi
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">An HTTP application for mocking client server services.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__inputhandling.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle">
<div class="title">The request parser for fidi (φίδι)<div class="ingroups"><a class="el" href="group__fidi.html">The service mock application fidi (φίδι)</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for The request parser for fidi (φίδι):</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__inputhandling.png" border="0" alt="" usemap="#group____inputhandling"/>
<map name="group____inputhandling" id="group____inputhandling">
<area shape="rect" id="node1" href="group__fidi.html" title="The service mock application\l fidi (φίδι)" alt="" coords="5,5,205,47"/>
</map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:fidi__driver_8cc"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fidi__driver_8cc.html">fidi_driver.cc</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:fidi__driver_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fidi__driver_8h.html">fidi_driver.h</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:fidi__flex__lexer_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fidi__flex__lexer_8h.html">fidi_flex_lexer.h</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:fidi__parser_8hh"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fidi__parser_8hh.html">fidi_parser.hh</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:fidi__scanner_8cc"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fidi__scanner_8cc.html">fidi_scanner.cc</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The input language parser is the core of fidi (φίδι). It consists of a simple scanner and a parser, and is used by both the lint and HTTP application components. It implements a simple language parser that is specific to fidi (φίδι). Writing a full grammar allows for adjustments to the language to be easier, it isolates the input request parsing from the rest of the application, and adding in error recovery rules to the grammar allows the error diagnostics for the parsing to be more thorough. The latter would be harder to implement were a general purpose markup language used for the requests. Most of the input handling code is shared between the linter and the HTTP application (all except the execute method).</p>
<p>Each instance of fidi_app mocks the behaviour of a single server in the service being mocked by fidi (φίδι); The number and targets of these calls are defined by the input request. Indeed, all aspects of the application’s behaviour are controlled by the input request, so the behaviour modeled by the mocked service maybe changed by each successive request.</p>
<h1><a class="anchor" id="nodes"></a>
Hosts/Nodes</h1>
<p>The request must specify the attributes of every instance of the fidi_app that is involved in the interaction defined in the request, either a source node or a destination node for HTTP requests. The host/node specification has a name, followed by square brackets containing a list of comma separated attribute key-value pairs </p><div class="fragment"><div class="line">.client    [ hostname = <span class="stringliteral">&quot;127.0.0.1&quot;</span>, port = 8001, ]</div></div><!-- fragment --><p> At a minimum, the node attributes must contain either a URL key-value pair, or both host and port definitions, so that the HTTP client request can be made to the host/node.</p>
<h1><a class="anchor" id="edges"></a>
Calls/Edges</h1>
<p>Each call is enclosed by square brackets, and differs from the node definition in that the requests are not named.</p>
<h2><a class="anchor" id="parameter"></a>
Request Parameters</h2>
<p>The request contains request parameters, which are comma separated key value pairs. The following keys have significance:</p>
<h3><a class="anchor" id="k1"></a>
predelay</h3>
<p>The value should be an unsigned integer that represents the number of milliseconds the fidi_app shall sleep on handling the request before taking any other action.</p>
<h3><a class="anchor" id="k2"></a>
postdelay</h3>
<p>The value should be an unsigned integer that represents the number of milliseconds the fidi_app shall sleep after all other actions for the request have been performed, and just before the call returns.</p>
<h3><a class="anchor" id="k3"></a>
response</h3>
<p>The value should be a legal HTTP response code (sanity checked to be a small integer less than 600).</p>
<h3><a class="anchor" id="k4"></a>
size</h3>
<p>The value should be an unsigned integer that represents the number of bytes in the returned response.</p>
<h3><a class="anchor" id="k5"></a>
memory</h3>
<p>The value should be an unsigned integer that represents the number of bytes of memory the fidi_app shall allocate during handling of the request.</p>
<h3><a class="anchor" id="k6"></a>
log_trace</h3>
<p>A string (preferably single line) to be (possibly) logged to the log file by fidi (φίδι) as a trace log. By default these messages are ignored.</p>
<h3><a class="anchor" id="k7"></a>
log_debug</h3>
<p>A string (preferably single line) to be (possibly) logged to the log file by fidi (φίδι) as a debug log.</p>
<h3><a class="anchor" id="k8"></a>
log_information</h3>
<p>A string (preferably single line) to be (possibly) logged to the log file by fidi (φίδι) as a information log.</p>
<h3><a class="anchor" id="k9"></a>
log_notice</h3>
<p>A string (preferably single line) to be (possibly) logged to the log file by fidi (φίδι).</p>
<h3><a class="anchor" id="k10"></a>
log_warning</h3>
<p>A string (preferably single line) to be (possibly) logged to the log file by fidi (φίδι).</p>
<h3><a class="anchor" id="k11"></a>
log_error</h3>
<p>A string (preferably single line) to be (possibly) logged to the log file by fidi (φίδι).</p>
<h3><a class="anchor" id="k12"></a>
log_critical</h3>
<p>A string (preferably single line) to be (possibly) logged to the log file by fidi (φίδι).</p>
<h3><a class="anchor" id="k13"></a>
log_fatal</h3>
<p>A string (preferably single line) to be (possibly) logged to the log file by fidi (φίδι).</p>
<h3><a class="anchor" id="k14"></a>
timeout_sec</h3>
<p>This represents the number of whole seconds of time to set as a timeout on downstream HTTP requests.</p>
<h3><a class="anchor" id="k15"></a>
timeout_usec</h3>
<p>This is the rest of the timeout time (a fraction of a second), represented as the number of microseconds. It is always less than one million.</p>
<h3><a class="anchor" id="k16"></a>
healthy</h3>
<p>The value is a boolean instructing the application to be healthy, or not, when responding to future /healthz requests. This only applies to health checks, and does not affect the respnse to requests.</p>
<h3><a class="anchor" id="k17"></a>
unresponsive_for_sec</h3>
<p>The value is a the number in whole seconds that the application node should be unresponsive for (as in drop all requests, including health checks (in this context drop means sending no respnse back; there is still something listening on the port and handling requests. The request will eventually time out with an empty server response)). This can be used, for instance, to simulate a restart.</p>
<h3><a class="anchor" id="k18"></a>
unresponsive_for_usec</h3>
<p>The value is a the number of fractional microseconds (less than a million) that the application node should be unresponsive for, in addioton to the unresponsive_for_sec value above.</p>
<h2><a class="anchor" id="calledge"></a>
Calls</h2>
<p>Interspersed in these attributes can be specifications for calls the fidi_app should make </p><div class="fragment"><div class="line">-&gt; frontend repeat = 2 sequence = 1 [...]</div></div><!-- fragment --><p>Each downstream call is defined by the arrow symbol "-&gt;", followed by the destination name (the name should already have been defined as detailed in the nodes section above), and optionally a repeat count, and/or a sequence number. The default repeat count is 1, and the default sequence number is 1 as well. This is followed by unparsed text in square brackets; those are instructions for the destination host to process. In fact, the content within the square brackets are identical to the call/edge format we have defined here.</p>
<p>Any number of calls can be defined. Calls with the same sequence number shall be made in parallel; repeated calls are always made in parallel. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
